@using Ardita.Extensions;
@using Ardita.Models.ViewModels;
@model Ardita.Models.ReportModels.ReportGlobalParams;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = GlobalConst.ViewStart;
    FormModel form = Html.Form();
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Companies</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action(GlobalConst.Index, GlobalConst.Home, new { Area = GlobalConst.General })"><i class="fa fa-home"></i></a>
            </li>
            <li class="breadcrumb-item">Master Data</li>
            <li class="active breadcrumb-item"><strong>Report</strong></li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight pb-0">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Report</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <form role="form" id="frmReport" enctype="multipart/form-data" asp-area=@GlobalConst.Report asp-controller=@GlobalConst.ReportArchiveActive asp-action=@GlobalConst.GenerateReport>
                        <div class="row">
                            <div class="col-sm-6 b-r">
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Perusahaan</label>
                                    <div class="col-lg-9">
                                        <select id="txtCompanyId" class="form-control" asp-items="ViewBag.ListCompany" data-placeholder="-- Semua --" asp-for="companyId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Lokasi Kearsipan</label>
                                    <div class="col-lg-9">
                                        <select id="txtArchiveUnitId" class="form-control" asp-items="ViewBag.ListArchiveUnit" data-placeholder="-- Semua --" asp-for="archiveUnitId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Ruangan</label>
                                    <div class="col-lg-9">
                                        <select id="txtRoomId" class="form-control" asp-items="ViewBag.ListRoom" data-placeholder="-- Semua --" asp-for="roomId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Rak</label>
                                    <div class="col-lg-9">
                                        <select id="txtRackId" class="form-control" asp-items="ViewBag.ListRack" data-placeholder="-- Semua --" asp-for="rackId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Tingkat</label>
                                    <div class="col-lg-9">
                                        <select id="txtLevelId" class="form-control" asp-items="ViewBag.ListLevel" data-placeholder="-- Semua --" asp-for="levelId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Baris</label>
                                    <div class="col-lg-9">
                                        <select id="txtRowId" class="form-control" asp-items="ViewBag.ListRow" data-placeholder="-- Semua --" asp-for="rowId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Status</label>
                                    <div class="col-lg-9">
                                        <input style="vertical-align:middle" type="radio" value="" id="all" asp-for="status" checked />
                                        <label for="all">Semua </label>
                                        <input style="vertical-align:middle;margin-left:5px;" type="radio" value="@false" id="available" asp-for="status" />
                                        <label for="available">@GlobalConst.Available </label>
                                        <input style="vertical-align:middle;margin-left:5px;" type="radio" value="@true" id="use" asp-for="status" />
                                        <label for="use">@GlobalConst.Used</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Bentuk Media Arsip</label>
                                    <div class="col-lg-9">
                                        <select id="txtGmdId" class="form-control" asp-items="ViewBag.ListGMD" data-placeholder="-- Semua --" asp-for="gmdId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Bentuk Media Simpan</label>
                                    <div class="col-lg-9">
                                        <select id="txtTypeStoraged" class="form-control" asp-items="ViewBag.ListTypeStorage" data-placeholder="-- Semua --" asp-for="typeStorageId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Pencipta Arsip</label>
                                    <div class="col-lg-9">
                                        <select id="txtCreatorId" class="form-control" asp-items="ViewBag.ListArchiveCreator" data-placeholder="-- Semua --" asp-for="creatorId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Pemilik Arsip</label>
                                    <div class="col-lg-9">
                                        <select id="txtOwnerId" class="form-control" asp-items="ViewBag.ListArchiveOwner" data-placeholder="-- Semua --" asp-for="archiveOwnerId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Klasifikasi</label>
                                    <div class="col-lg-9">
                                        <select id="txtClaasificationId" class="form-control" asp-items="ViewBag.ListClassification" data-placeholder="-- Semua --" asp-for="classificationId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Subjek Klasifikasi</label>
                                    <div class="col-lg-9">
                                        <select id="txtSubjectClaasificationId" class="form-control" asp-items="ViewBag.ListSubjectClassification" data-placeholder="-- Semua --" asp-for="subjectClassificationId"><option value=""></option></select>
                                    </div>
                                </div>
                                <div class="form-group row rowreport">
                                    <label class="col-lg-3 col-form-label">Periode Penciptaan</label>
                                    <div class="col-lg-4">
                                        <input type="date" id="txtStartDate" class="form-control" asp-for="startDate" />
                                    </div>
                                    <div class="col-lg-1" style="text-align: center;padding: 6px;">
                                        <strong>s/d</strong>
                                    </div>
                                    <div class="col-lg-4">
                                        <input type="date" id="txtEndDate" class="form-control" asp-for="endDate" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="form-group mb-0">
                                    <a class="btn btn-sm btn-warning mr-2" id="btnSearch" href="@Url.Action(GlobalConst.Index, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })"><i class="fa fa-refresh"></i> Clear Search</a>
                                    <button class="btn btn-sm btn-primary" id="btnSearch"><i class="fa fa-filter" onclick=""></i> Generate Report</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h4>Preview</h4>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12">
                            @if (form.CurrentAction == GlobalConst.GenerateReport)
                            {
                                <div class="form-group">
                                    <a href="~/Report/@ViewBag.FileExcel" class="btn btn-sm btn-warning float-left m-t-n-xs" id="btnSearch" style="margin-right: 10px" download="@ViewBag.FileExcel"><i class="fa fa-file-excel-o"></i> Export Excel</a>
                                    <a href="~/Report/@ViewBag.FilePdf" class="btn btn-sm btn-info float-left m-t-n-xs" id="btnSearch" download="@ViewBag.FilePdf"><i class="fa fa-file-pdf-o"></i> Export PDF</a>
                                </div>
                                <div class="form-group" style="margin-top: 30px">
                                    <embed src="~/Report/@ViewBag.FilePdf#view=FitH" style="width:100%;min-height:500px" />
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    @*<script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>*@
    <script type="text/javascript">
        //var pdfDoc = null;
        //var scale = 2; //Set Scale for zooming PDF.
        //var dataBase64 = '@Html.Raw(ViewBag.Data)';
        //if(dataBase64 != ''){

        //    function RenderPage(pdf_container, num) {
        //    pdfDoc.getPage(num).then(function (page) {
        //        //Create Canvas element and append to the Container DIV.
        //        var canvas = document.createElement('canvas');
        //        canvas.style.width = "100%";
        //        canvas.id = 'pdf-' + num;
        //        var ctx = canvas.getContext('2d');
        //        pdf_container.appendChild(canvas);
 
        //        //Create and add empty DIV to add SPACE between pages.
        //        var spacer = document.createElement("div");
        //        spacer.style.height = "2px";
        //        pdf_container.appendChild(spacer);
 
        //        //Set the Canvas dimensions using ViewPort and Scale.
        //        var viewport = page.getViewport({ scale: scale });
        //        canvas.height = viewport.height;
        //        canvas.width = viewport.width;
 
        //        //Render the PDF page.
        //        var renderContext = {
        //            canvasContext: ctx,
        //            viewport: viewport,
        //            //transform: [resolution, 0, 0, resolution, 0, 0]
        //        };
 
        //       page.render(renderContext);
        //    });
        //};

        //    var pdfData = atob(dataBase64.split(',')[1]);

        //    // Loaded via <script> tag, create shortcut to access PDF.js exports.
        //    var pdfjsLib = window['pdfjs-dist/build/pdf'];

        //    // The workerSrc property shall be specified.
        //    pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

        //    // Using DocumentInitParameters object to load binary data.
        //    var loadingTask = pdfjsLib.getDocument({ data: pdfData });
        //    loadingTask.promise.then(function (pdf) {

        //        pdfDoc = pdf;
        //        var pdf_container = document.getElementById("pdf_container");
        //        for (var i = 1; i <= pdfDoc.numPages; i++) {
        //            RenderPage(pdf_container, i);
        //        }
        //    }, function (reason) {
        //        // PDF loading error
        //        console.error(reason);
        //    });
        //}

        $(function(){
            initDropdown();
        });
        function initDropdown() {
            initGlobalDropdown($('#txtArchiveUnitId'), '@Url.Action(GlobalConst.BindArchiveUnitsByCompanyIdAndParam, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtCompanyId'));

            initGlobalDropdown($('#txtRoomId'), '@Url.Action(GlobalConst.BindRoomActiveByArchiveUnitId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtArchiveUnitId'));

            initGlobalDropdown($('#txtRackId'), '@Url.Action(GlobalConst.BindParamRackByRoomId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtRoomId'));

            initGlobalDropdown($('#txtLevelId'), '@Url.Action(GlobalConst.BindParamLevelByRackId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtRackId'));

            initGlobalDropdown($('#txtRowId'), '@Url.Action(GlobalConst.BindParamRowByLevelId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtLevelId'));

            initGlobalDropdown($('#txtCreatorId'), '@Url.Action(GlobalConst.BindParamCreatorByArchiveUnitId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtArchiveUnitId'));

            initGlobalDropdown($('#txtSubjectClaasificationId'), '@Url.Action(GlobalConst.BindParamClassificationSubjectIdByClassificationId, GlobalConst.ReportArchiveActive, new { Area = GlobalConst.Report })', $('#txtClaasificationId'));
        }
    </script>
}