@model Ardita.Models.ViewModels.RolePages.RolePageListViewModel
@using Ardita.Extensions;
@using Ardita.Models.ViewModels;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    FormModel form = Html.Form();
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Role</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "UserRole")">Detail User Roles</a>
            </li>
            <li class="active breadcrumb-item">
                <strong>Data</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Role Page Detail</h5>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-6 b-r">
                            <form role="form" enctype="multipart/form-data" asp-controller="RolePage" asp-area="UserManage" asp-action="Save">
                      
                                <div class="form-group">
                                    <label>Role</label>
                                    <input type="hidden" asp-for="rolePage.RoleId" value="@(Model.role.RoleId)" />
                                    <input type="text" placeholder="" class="form-control" value="@(Model.role.Name)" disabled="">
                                </div>
                                @*<div class="form-group">
                                    <label>Page</label>
                                    <select asp-for="rolePage.PageId" id="PageId" class="select2_demo_1 form-control">
                                        @foreach (var item in Model.rolePageSubMenu)
                                        {
                                            <option value="@item.PageId">@(item.SubMenuName) / @(item.PageName) / @(item.PagePath) </option>
                                        }
                                    </select>
                                </div>*@
                                <div class="form-group">
                                    <a href="@Url.Action("Index", "RolePage", new { Area = "UserManage" })" class="btn btn-sm btn-danger float-right m-t-n-xs">@Html.Raw(form.BackText)</a>
                                    <a href="#" class="btn btn-sm btn-primary float-right m-t-n-xs mr-1" onclick="submitMe()">Save</a>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-6 b-r">
                            <div id="jstree1" style="min-height: 300px">
                                <div class="sk-spinner sk-spinner-circle">
                                    <div class="sk-circle1 sk-circle"></div>
                                    <div class="sk-circle2 sk-circle"></div>
                                    <div class="sk-circle3 sk-circle"></div>
                                    <div class="sk-circle4 sk-circle"></div>
                                    <div class="sk-circle5 sk-circle"></div>
                                    <div class="sk-circle6 sk-circle"></div>
                                    <div class="sk-circle7 sk-circle"></div>
                                    <div class="sk-circle8 sk-circle"></div>
                                    <div class="sk-circle9 sk-circle"></div>
                                    <div class="sk-circle10 sk-circle"></div>
                                    <div class="sk-circle11 sk-circle"></div>
                                    <div class="sk-circle12 sk-circle"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    @*<table id="tblRolePage" class="table table-striped table-hover dataTables-example">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Sub Menu</th>
                                <th>Sub Menu Path</th>
                                <th>Page Name</th>
                                <th>Page Path</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.rolePages)
                            {
                                <tr>
                                    <td><a class="btn btn-danger btn-sm" href="@Url.Action("Remove", "RolePage", new { Area="UserManage", id = item.RolePageId})"><i class="fa fa-trash"></i></a></td>
                                    <td>@item.SubMenuName</td>
                                    <td>@item.SubMenuPath</td>
                                    <td>@item.PageName</td>
                                    <td>@item.pagePath</td>
                                </tr>
                            }
                        </tbody>
                    </table>*@
                </div>
            </div>
        </div>

    </div>
</div>
@section Styles {
    <environment include="Development">
        <link rel="stylesheet" href="~/lib/jstree/dist/themes/default/style.css" />
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="~/lib/jstree/dist/themes/default/style.min.css" />
    </environment>
    <style>
        #jstree1 > .sk-spinner {
            display: none;
        }

        #jstree1.sk-loading {
            position: relative;
        }

            #jstree1.sk-loading > .sk-spinner {
                display: block;
                position: absolute;
                top: 40%;
                left: 0;
                right: 0;
                z-index: 3000;
            }

            #jstree1.sk-loading:after {
                content: '';
                background-color: rgba(255, 255, 255, 0.7);
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 2999;
            }
    </style>
}

@section Scripts {
    <environment include="Development">
        <script src="~/lib/jstree/dist/jstree.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/lib/jstree/dist/jstree.min.js"></script>
    </environment>

    <script type="text/javascript">
        function submitMe() {
            $('#wrapper').toggleClass('sk-loading');
            var selectedElmsIds = [];
            var selectedElms = $('#jstree1').jstree("get_selected", true);
            $.each(selectedElms, function () {
                selectedElmsIds.push(this.id);
            });

            var url = '@Url.Action("Save", "RolePage", new { Area = "UserManage" })';
            var param = new Object();

            param.role = '@Model.role.RoleId';
            param.listPage = selectedElmsIds;
            ajaxcallreturn(url, 'POST', param, '', 'multipart/form-data').then(function (result) {
                $('#wrapper').toggleClass('sk-loading');
                if(result.code == 200){
                    swal({ title : "Pesan!", text: result.msg, type: "success"}, function () {
                        location.reload();
                        });
                }else{
                    swal({ title: "Error!", text: result.msg, type: "error" }, function () {
                        location.reload();
                    });
                }
            });
        }
        function loadTree() {
            $('#jstree1').toggleClass('sk-loading');
            var url = '@Url.Action("GetDataTreeView", "RolePage", new { Area = "UserManage", id = Model.role.RoleId })';
            var param = JSON.stringify({
                id: '@Model.role.RoleId'
            });

            ajaxcallreturn(url, 'POST', param, '', 'application/json; charset=UTF-8').then(function (result) {
                $('#jstree1').toggleClass('sk-loading');
                $('#jstree1').jstree({
                    'core': {
                        'data': result
                    },
                    'plugins': ["themes", "html_data", "checkbox", "sort", "ui"],
                    'types': {
                        'default': {
                            'icon': 'fa fa-folder'
                        },
                        'html': {
                            'icon': 'fa fa-file-code-o'
                        },
                        'svg': {
                            'icon': 'fa fa-file-picture-o'
                        },
                        'css': {
                            'icon': 'fa fa-file-code-o'
                        },
                        'img': {
                            'icon': 'fa fa-file-image-o'
                        },
                        'js': {
                            'icon': 'fa fa-file-text-o'
                        }

                    }
                });
            });
        }
        $(document).ready(function () {
            loadTree();
            console.log('@TempData["success"]');
            if ('@TempData["success"]' != null && '@TempData["success"]' != '') {
                showMessage('Pesan!', '@TempData["success"]', 'success');
            }
        });
    </script>
}