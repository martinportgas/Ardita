@using Ardita.Extensions;
@using Ardita.Models.ViewModels;
@using Ardita.Models.DbModels;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = GlobalConst.ViewStart;
    FormModel form = Html.Form();
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Pencarian Arsip</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action(GlobalConst.Index, GlobalConst.Home, new { Area = GlobalConst.General })"><i class="fa fa-home"></i></a>
            </li>
            <li class="breadcrumb-item">
                Master Data
            </li>
            <li class="active breadcrumb-item">
                <strong>Pencarian Arsip</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">

            <div class="row">
                <div class="col-sm-12">
                    <a href="@Url.Action(GlobalConst.Index, GlobalConst.Home, new {Area = GlobalConst.General})" class="btn btn-sm btn-default float-left m-t-n-xs mb-2" style="box-shadow: 3px 3px 6px #b8b9be,-3px -3px 6px #fff;border-color: #d1d9e6;transition: all .2s ease;background-color: #f3f3f4;color: #31344b;border-radius: .55rem;" id="btn-cancel">@Html.Raw(GlobalConst.IconBack + " " + GlobalConst.Back)</a>
                </div>
            </div>
            <div class="ibox" style="border:none !important">
                <div class="ibox-title gray-bg" style="min-height:0px !important;">
                    @*<h5>Pencarian Arsip</h5>
                    <div class="ibox-tools">
                    </div>*@
                </div>
                <div class="ibox-content gray-bg" style="border:none !important;padding:0px !important">

                    <table id="tbl" class="table dataTables-example" style="width:100%">
                        <thead>
                            <tr>
                                <th>Hasil Pencarian Arsip</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.Data.Count > 0)
                            {
                                foreach (TrxArchive item in ViewBag.Data)
                                {
                                    <tr class="gray-bg">
                                        <td>
                                            <div class="card shadow-inset border-light gray-bg" style="border-color: #d1d9e6!important;box-shadow: inset 2px 2px 5px #b8b9be,inset -3px -3px 7px #fff!important;">
                                                <div class="card-body p-4">
                                                    <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                        <div style="width:200px;"><strong>Klasifikasi - Subjek Klasifikasi</strong></div>
                                                        <div> : </div>
                                                        <div class="ml-2"><p>@item.SubSubjectClassification.SubjectClassification.Classification.ClassificationName - @item.SubSubjectClassification.SubjectClassification.SubjectClassificationName</p></div>
                                                    </div>
                                                    <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                        <div style="width:200px;"><strong>Judul Arsip</strong></div>
                                                        <div> : </div>
                                                        <div class="ml-2"><p>@item.TitleArchive</p></div>
                                                    </div>
                                                    <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                        <div style="width:200px;"><strong>Pemilik - Unit Pencipta</strong></div>
                                                        <div> : </div>
                                                        <div class="ml-2"><p>@item.ArchiveOwner.ArchiveOwnerName - @item.Creator.CreatorName</p></div>
                                                    </div>
                                                    <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                        <div style="width:200px;"><strong>Status</strong></div>
                                                        <div> : </div>
                                                        @if (form.CurrentAction == "SearchActive")
                                                        {
                                                            <div class="ml-2"><p>@Html.Raw(item.IsUsed == true ? "<span class='badge badge-pill badge-success'>Digunakan</span>" : "<span class='badge badge-pill badge-primary'>Tersedia</span>")</p></div>
                                                        }
                                                        else
                                                        {
                                                            <div class="ml-2"><p>@Html.Raw(item.TrxMediaStorageInActiveDetails.FirstOrDefault() == null ? "<span class='badge badge-pill badge-primary'>Tersedia</span>" : item.TrxMediaStorageInActiveDetails.FirstOrDefault().IsRent == true ? "<span class='badge badge-pill badge-success'>Dipinjam</span>" : "<span class='badge badge-pill badge-primary'>Tersedia</span>")</p></div>
                                                        }
                                                    </div>
                                                    <div class="d-flex align-items-center">
                                                        <a data-toggle="modal" data-target="@("#Archive" + item.ArchiveId.ToString().ToLower())" class="btn btn-primary btn-sm mr-3" style="box-shadow: 3px 3px 6px #b8b9be,-3px -3px 6px #fff;border-color: #d1d9e6;transition: all .2s ease;background-color: #f3f3f4;color: #31344b;border-radius: .55rem;">View Detail</a>
                                                    </div>

                                                    <div class="modal inmodal" id="@("Archive" + item.ArchiveId.ToString().ToLower())" tabindex="-1" role="dialog" aria-hidden="true">
                                                        <div class="modal-dialog modal-lg">
                                                            <div class="modal-content animated fadeIn">
                                                                <form id="frmFloorUpload" method="post" enctype="multipart/form-data" asp-controller="@GlobalConst.Floor" asp-action="@GlobalConst.Upload" asp-area="@GlobalConst.MasterData">
                                                                    @Html.AntiForgeryToken();
                                                                    <div class="modal-header">
                                                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                                                        <h4 class="modal-title">Detail Arsip</h4>
                                                                    </div>
                                                                    <div class="modal-body">

                                                                        <div class="row">
                                                                            <div class="col-sm-12">
                                                                                <div class="card shadow-inset border-light gray-bg" style="border-color: #d1d9e6!important;box-shadow: 2px 2px 5px #b8b9be,inset -3px -3px 7px #fff!important;">
                                                                                    <div class="card-body p-4">
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Judul</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.TitleArchive</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Klasifikasi</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.SubSubjectClassification.SubjectClassification.Classification.ClassificationName</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Subjek Klasifikasi</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.SubSubjectClassification.SubjectClassification.SubjectClassificationName</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Nomor Dokumen</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.DocumentNo</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Lokasi Arsip</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.Creator.ArchiveUnit.ArchiveUnitName</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Lokasi Simpan</strong></div>
                                                                                            <div> : </div>
                                                                                            @if (form.CurrentAction == "SearchActive")
                                                                                            {
                                                                                                @if (item.TrxMediaStorageDetails.FirstOrDefault() != null)
                                                                                                {
                                                                                                    <div class="ml-2">
                                                                                                        <p>
                                                                                                            @(
                                                                                                                item.TrxMediaStorageDetails.FirstOrDefault().MediaStorage.Row.Level.Rack.Room.RoomName + " - " +
                                                                                                                item.TrxMediaStorageDetails.FirstOrDefault().MediaStorage.Row.Level.Rack.RackName + " - " +
                                                                                                                item.TrxMediaStorageDetails.FirstOrDefault().MediaStorage.Row.Level.LevelName + " - " +
                                                                                                                item.TrxMediaStorageDetails.FirstOrDefault().MediaStorage.Row.RowName

                                                                                                                )
                                                                                                    </div>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <div class="ml-2"><p>-</p></div>
                                                                                                }
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                @if (item.TrxMediaStorageInActiveDetails.FirstOrDefault() != null)
                                                                                                {
                                                                                                    <div class="ml-2">
                                                                                                        <p>
                                                                                                            @(
                                                                                                                item.TrxMediaStorageInActiveDetails.FirstOrDefault().MediaStorageInActive.Row.Level.Rack.Room.RoomName + " - " +
                                                                                                                item.TrxMediaStorageInActiveDetails.FirstOrDefault().MediaStorageInActive.Row.Level.Rack.RackName + " - " +
                                                                                                                item.TrxMediaStorageInActiveDetails.FirstOrDefault().MediaStorageInActive.Row.Level.LevelName + " - " +
                                                                                                                item.TrxMediaStorageInActiveDetails.FirstOrDefault().MediaStorageInActive.Row.RowName

                                                                                                                )
                                                                                                    </div>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <div class="ml-2"><p>-</p></div>
                                                                                                }
                                                                                            }
                                                                                            
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Tanggal Arsip</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.CreatedDateArchive.ToShortDateString()</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Pemilik</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.ArchiveOwner.ArchiveOwnerName</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Pencipta</strong></div>
                                                                                            <div> : </div>
                                                                                            <div class="ml-2"><p>@item.Creator.CreatorName</div>
                                                                                        </div>
                                                                                        <div style="font-family:Nunito Sans,sans-serif;color: #44476a;display:flex;flex-direction:row">
                                                                                            <div style="width:200px;"><strong>Status</strong></div>
                                                                                            <div> : </div>
                                                                                            @if (form.CurrentAction == "SearchActive")
                                                                                            {
                                                                                                <div class="ml-2"><p>@Html.Raw(item.IsUsed == true ? "<span class='badge badge-pill badge-success'>Digunakan</span>" : "<span class='badge badge-pill badge-primary'>Tersedia</span>")</p></div>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <div class="ml-2"><p>@Html.Raw(item.TrxMediaStorageInActiveDetails.FirstOrDefault() == null ? "<span class='badge badge-pill badge-primary'>Tersedia</span>" : item.TrxMediaStorageInActiveDetails.FirstOrDefault().IsRent == true ? "<span class='badge badge-pill badge-success'>Dipinjam</span>" : "<span class='badge badge-pill badge-primary'>Tersedia</span>")</p></div>
                                                                                            }
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row mt-2">
                                                                            <div class="col-sm-12">
                                                                                <div class="card shadow-inset border-light gray-bg" style="border-color: #d1d9e6!important;box-shadow: 2px 2px 5px #b8b9be,inset -3px -3px 7px #fff!important;">
                                                                                    <div class="card-body p-4">
                                                                                        <h5>Arsip Digital</h5>
                                                                                        <hr>
                                                                                        <div class="row mt-2">
                                                                                            @if(item.TrxFileArchiveDetails.Count > 0)
                                                                                            {
                                                                                                foreach (TrxFileArchiveDetail file in item.TrxFileArchiveDetails)
                                                                                                {
                                                                                                    <div class="col-sm-6">
                                                                                                        <span>@file.FileName</span><br>
                                                                                                        @if (file.FileType == "application/pdf" || file.FileType.ToLower().Contains("image"))
                                                                                                        {
                                                                                                            <embed src="@Url.Action("BindFileArchive", GlobalConst.Home, new { Areas = GlobalConst.General, Id = file.FileArchiveDetailId, IsDownload = false})" style="width:100%;min-height:300px" />
                                                                                                        }
                                                                                                        else
                                                                                                        {
                                                                                                            <a href="@Url.Action("BindFileArchive", GlobalConst.Home, new { Areas = GlobalConst.General, Id = file.FileArchiveDetailId, IsDownload = true})" download="@file.FileName"><i class="fa fa-download"></i>Download</a>
                                                                                                        }
                                                                                                    </div>
                                                                                                }
                                                                                            }
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </form>

                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!--Modal-->
        
    </div>
</div>
@section styles {
    <style>
        .btn:hover {
            box-shadow: inset 3px 3px 6px #b8b9be,-3px -3px 6px #fff !important;
        }
    </style>
}

@section Scripts {
    <script type="text/javascript">

        $(document).ready(function () {
            $('#tbl').DataTable({});
        });
    </script>
}